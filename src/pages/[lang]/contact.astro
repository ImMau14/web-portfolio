---
import BaseLayout from "@layouts/BaseLayout.astro"
import ContactForm from "@components/ContactForm.tsx"
import { getEntry } from "astro:content"
import { locales, defaultLocale } from "@content/utils"
import type { CollectionEntry, DataEntryMap } from "astro:content"

export async function getStaticPaths() {
  return locales.map((lang) => ({ params: { lang } }))
}

const { lang } = Astro.params as { lang: string }

async function getEntryOrFallback<C extends keyof DataEntryMap>(
  collection: C,
  id: string,
  fallbackLang = defaultLocale,
): Promise<CollectionEntry<C>> {
  const entry = (await getEntry(collection, id)) as CollectionEntry<C> | undefined
  if (entry) return entry

  const fallbackId = id.replace(/^.*?\//, `${fallbackLang}/`)
  const fallbackEntry = (await getEntry(collection, fallbackId)) as CollectionEntry<C> | undefined
  if (fallbackEntry) return fallbackEntry

  throw new Error(`Entry not found for ${id} and fallback ${fallbackId}`)
}

const layoutEntryId = `${lang}/BaseLayout`
const layoutEntryData = await getEntryOrFallback("pages", layoutEntryId)

const contactEntryId = `${lang}/contact`
const contactData = await getEntryOrFallback("pages", contactEntryId)
---

<BaseLayout
  className="flex flex-col items-center justify-center py-4 bg-silver-1000"
  baseLang={layoutEntryData.data}
  pageName={contactData.data.pageName}
>
  <ContactForm className="w-full" textData={contactData.data} />
</BaseLayout>
